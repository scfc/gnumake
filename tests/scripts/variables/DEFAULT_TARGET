#                                                                    -*-perl-*-
$description = "Test the .DEFAULT_TARGET special variable.";

$details = "";


# Test #1: basic logic.
#
run_make_test('
# Basics.
#
foo: ; @:

ifneq ($(.DEFAULT_TARGET),foo)
$(error )
endif

# Reset to empty.
#
.DEFAULT_TARGET :=

bar: ; @:

ifneq ($(.DEFAULT_TARGET),bar)
$(error )
endif

# Change to a different target.
#

.DEFAULT_TARGET := baz

baz: ; @echo $@
',
'',
'baz');


# Test #2: unknown target.
#
run_make_test('
.DEFAULT_TARGET := foo
',
'',
'make: *** No rule to make target `foo\'.  Stop.',
512);


# Test #3: more than one target.
#
run_make_test('
.DEFAULT_TARGET := foo bar
',
'',
'make: *** .DEFAULT_TARGET contains more than one target.  Stop.',
512);


# Test #4: Savannah bug #12226.
#
run_make_test('
define rule
foo: ; @echo $$@
endef

define make-rule
$(eval $(rule))
endef

$(call make-rule)

',
'',
'foo');


# This tells the test driver that the perl test script executed properly.
1;
